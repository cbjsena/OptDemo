{% extends "core/base.html" %}
{% load static %}

{% block title %}Capacitated VRP (CVRP) - Introduction{% endblock %}

{% block styles %}
<style>
    /* 제공해주신 vrp_introduction.html의 스타일을 기반으로 통일성 있게 구성 */
    .introduction-content {
        line-height: 1.8;
        font-size: 1.05rem;
    }
    .introduction-content h4 {
        margin-top: 1.5rem;
        margin-bottom: 0.75rem;
        color: #0056b3;
        padding-bottom: 0.25rem;
        border-bottom: 2px solid #007bff;
    }
    .introduction-content ul {
        padding-left: 20px;
    }
    .introduction-content li {
        margin-bottom: 0.5rem;
    }
    .math-model-section {
        background-color: #f8f9fa;
        border: 1px solid #e9ecef;
        border-radius: 5px;
        padding: 20px; /* 패딩 조정 */
        margin-top: 15px;
    }
    .math-formula { /* 수식 표현용 스타일 추가 */
        font-family: 'Courier New', Courier, monospace;
        background-color: #e9ecef;
        padding: 10px;
        border-radius: 3px;
        display: block;
        white-space: pre-wrap;
        margin: 10px 0;
        font-size: 0.95em;
    }
    .intro-image {
        max-width: 100%;
        height: auto;
        border: 1px solid #ddd;
        border-radius: 4px;
        padding: 5px;
        margin-top: 10px;
        margin-bottom: 20px;
        display: block;
        margin-left: auto;
        margin-right: auto;
        background-color: #fff;
    }
    .image-caption {
        font-size: 0.9rem;
        color: #555;
        text-align: center;
        margin-top: -15px;
        margin-bottom: 25px;
    }
    .highlight-box {
        background-color: #fffbe6;
        border-left: 5px solid #ffc107;
        padding: 20px;
        margin: 25px 0;
        border-radius: 4px;
    }
    .highlight-box h4 {
        margin-top: 0;
        color: #856404;
        border-bottom: none; /* 하이라이트 박스 내 h4는 밑줄 없음 */
        padding-bottom: 0;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid introduction-content">
    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
        <h1 class="h2">용량 제약 차량 경로 문제 (Capacitated VRP - CVRP)</h1>
    </div>

    <p><strong>범주: Ⅲ. 경로 최적화 및 물류 (Routing & Logistics)</strong></p>
    <p>
        **용량 제약 차량 경로 문제(CVRP)**는 기본적인 차량 경로 문제(VRP)에 현실 세계의 중요한 제약 조건인 **차량의 적재 용량**을 추가한 확장 모델입니다. 이는 물류 및 배송 분야에서 가장 널리 적용되는 최적화 문제 중 하나입니다.
    </p>

    <h4>1. CVRP의 핵심: 용량과 수요</h4>
    <p>
        기존 VRP의 구성 요소(물류센터, 고객, 차량, 경로)에 다음 두 가지 핵심 요소가 추가됩니다:
    </p>
    <ul>
        <li>
            <strong>고객 수요 (Customer Demand):</strong> 각 고객이 필요로 하는 물품의 양(무게, 부피, 개수 등)입니다. 모든 고객의 수요는 반드시 충족되어야 합니다.
        </li>
        <li>
            <strong>차량 용량 (Vehicle Capacity):</strong> 각 차량이 최대로 실을 수 있는 물품의 양입니다.
        </li>
    </ul>

    <figure>
        <img src="{% static 'routing_logistics_app/images/cvrp_concept.png' %}" alt="CVRP 개념도" class="intro-image" style="max-width: 500px;">
        <figcaption class="image-caption">그림 1: CVRP 개념 - 각 고객은 수요(숫자)를 가지며, 각 차량은 용량(C) 한계를 가집니다.</figcaption>
    </figure>

    <div class="highlight-box">
        <h4>CVRP의 핵심 제약: 용량 제약 (Capacity Constraint)</h4>
        <p>
            <strong>"한 대의 차량이 방문하는 모든 고객들의 수요량 합계는 해당 차량의 용량을 초과할 수 없다."</strong>
        </p>
        <p>
            이 제약 조건 하나가 추가됨으로써 문제는 VRP와 근본적으로 달라집니다. 제한이 없는 VRP에서는 이론적으로 한 대의 차량이 모든 고객을 방문할 수 있었지만, CVRP에서는 고객들의 총수요량이 한 차량의 용량을 초과하는 순간부터 **반드시 여러 대의 차량을 사용**해야만 합니다.
        </p>
        <p>
            따라서 CVRP는 단순히 최단 경로를 찾는 문제를 넘어, **어떤 고객들을 어떤 차량에 그룹으로 묶어 할당할 것인가(Clustering)**와 **각 그룹 내에서 어떤 순서로 방문할 것인가(Routing)**를 동시에 최적화해야 하는 더 복잡한 문제가 됩니다.
        </p>
    </div>

    <h4>2. 산업 응용 분야</h4>
    <p>CVRP는 적재 용량이 중요한 모든 물류 시나리오에 적용됩니다.</p>
    <ul>
        <li><strong>대량 화물 운송:</strong> 트럭, 화물선 등을 이용한 B2B 물류에서 적재 용량은 가장 중요한 제약 조건 중 하나입니다.</li>
        <li><strong>식료품 및 음료 배달:</strong> 신선식품, 음료수 박스 등 부피나 무게가 큰 상품을 배송할 때 차량의 용량을 고려해야 합니다.</li>
        <li><strong>소매 유통 물류:</strong> 중앙 물류센터에서 여러 지점으로 상품을 공급할 때 각 지점의 주문량을 합산하여 차량 경로를 계획합니다.</li>
        <li><strong>산업 폐기물 수거:</strong> 각 수거 지점의 폐기물 양을 고려하여 수거 트럭의 용량을 초과하지 않는 최적의 수거 경로를 결정합니다.</li>
    </ul>

    <h4>3. 수학적 모델의 변화</h4>
    <div class="math-model-section">
        <h4>VRP 모델에 추가되는 요소</h4>
        <p>기본 VRP 모델에 용량 제약을 추가하기 위해 다음과 같은 요소들이 필요합니다.</p>
        <ul>
            <li><strong>추가 파라미터:</strong>
                <ul>
                    <li>$q_i$: 고객 $i$의 수요량 (단, $q_0 = 0$ for depot)</li>
                    <li>$Q_k$: 차량 $k$의 용량</li>
                </ul>
            </li>
            <li>
                <strong>주요 추가 제약식:</strong>
                <p>각 차량 $k$에 대해, 해당 차량이 방문하는 모든 고객들의 수요 합은 차량 $k$의 용량을 초과할 수 없습니다.</p>
                <div class="math-formula">$$\sum_{i \in C} q_i y_{ik} \le Q_k, \quad \forall k \in K$$</div>
                <p><small>(여기서 $y_{ik}$는 고객 $i$를 차량 $k$가 방문하면 1, 아니면 0인 이진 변수입니다. 또는 다른 형태의 수식으로 표현될 수 있습니다.)</small></p>
            </li>
        </ul>
    </div>

    <h4>4. OptDemo에서의 체험</h4>
    <p>
        "용량 제약 차량 경로 문제 (CVRP)" 데모에서는 사용자가 각 고객의 수요량과 차량의 용량을 직접 설정할 수 있습니다. 이를 통해 용량 제약이 없을 때와 있을 때 최적 경로가 어떻게 달라지는지, 여러 차량에 고객들이 어떻게 자동으로 그룹화되는지를 시각적으로 비교하고 체험할 수 있습니다.
    </p>
</div>
{% endblock %}

{% block scripts %}
{# MathJax 로드 (base.html에 이미 Chart.js 등이 있다면 그 이후에 로드하는 것이 좋음) #}
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        console.log("VRP Model Definition page script loaded.");
        if (typeof MathJax !== 'undefined' && MathJax.typeset) {
            // 페이지 로드 후 MathJax가 수식을 렌더링하도록 명시적 호출 (필요한 경우)
            // MathJax.typesetPromise(); // 또는 MathJax.typeset();
        }
    });
</script>
{% endblock %}