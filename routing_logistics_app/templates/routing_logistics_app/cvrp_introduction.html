{% extends "core/base.html" %}
{% load static %}

{% block title %}Capacitated VRP (CVRP) - Introduction{% endblock %}

{% block styles %}
    <link rel="stylesheet" href="{% static 'core/css/instruction.css' %}">
    <link rel="stylesheet" href="{% static 'core/css/model.definition.css' %}">
{% endblock %}

{% block content %}
<div class="container-fluid introduction-content">
    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
        <h2 class="h2">용량 제약 차량 경로 문제 (Capacitated VRP - CVRP)</h2>
    </div>

    <p class="lead">
        <strong>용량 제약 차량 경로 문제(CVRP)</strong>는 기본적인 차량 경로 문제(VRP)에 현실 세계의 중요한 제약 조건인
        <strong>차량의 적재 용량</strong>을 추가한 확장 모델입니다. 이는 물류 및 배송 분야에서 가장 널리 적용되는 최적화 문제 중 하나입니다.
    </p>

    <div class="row">
        <div class="col-lg-8">
            <h3>1. 문제 설명: VRP와의 차이점</h3>
            <p>
                CVRP는 기본 VRP의 모든 구성 요소를 공유하지만, 두 가지 핵심 개념이 추가됩니다.
            </p>
            <ul>
                <li><strong>고객 수요 (Customer Demand):</strong> 각 고객이 필요로 하는 물품의 양(무게, 부피 등)입니다.</li>
                <li><strong>차량 용량 (Vehicle Capacity):</strong> 각 차량이 최대로 실을 수 있는 물품의 양입니다.</li>
            </ul>

            <figure class="text-center my-4">
                <img src="{% static 'routing_logistics_app/images/cvrp_concept.png' %}"
                     alt="CVRP 개념도" class="intro-image img-fluid" style="max-width: 600px;">
                <figcaption class="image-caption mt-2">그림 1: CVRP 개념 - 각 고객은 수요(숫자)를 가지며, 각 차량은 용량(C) 한계를 가집니다.</figcaption>
            </figure>

            <div class="highlight-box">
                <h4>CVRP의 핵심 제약: 용량 초과 금지</h4>
                <p class="mb-0">
                    <strong>"한 대의 차량에 할당된 모든 고객들의 수요량 합계는 해당 차량의 용량을 초과할 수 없다."</strong>
                </p>
                <hr>
                <p>
                    이 제약 조건으로 인해 CVRP는 단순히 최단 경로를 찾는 것을 넘어,
                    어떤 고객들을 어떤 차량에 그룹으로 묶을 것인가(Clustering)와
                    각 그룹 내에서 어떤 순서로 방문할 것인가(Routing)를 동시에 최적화해야 하는 더 복잡하고 현실적인 문제가 됩니다.
                </p>
            </div>

            <h3>2. 산업 응용 분야</h3>
            <ul>
                <li><strong>대량 화물 운송:</strong> 트럭, 화물선 등을 이용한 B2B 물류에서 적재 용량은 가장 중요한 제약 조건 중 하나입니다.</li>
                <li><strong>식료품 및 음료 배달:</strong> 신선식품, 음료수 박스 등 부피나 무게가 큰 상품을 배송할 때 차량의 용량을 고려해야 합니다.</li>
                <li><strong>소매 유통 물류:</strong> 중앙 물류센터에서 여러 지점으로 상품을 공급할 때 각 지점의 주문량을 합산하여 차량 경로를 계획합니다.</li>
            </ul>

            <h3>3. 수학적 모델</h3>
            <p>CVRP 모델은 VRP의 수학적 모델에 새로운 입력 데이터와 제약 조건을 추가하여 구성됩니다.</p>
            <h4>목적 함수 및 기본 제약 조건</h4>
            <p>총 이동 거리를 최소화하는 목적 함수와 고객 방문, 차량 흐름 보존 등 VRP의 기본 제약 조건들은 그대로 유지됩니다.</p>
            <div class="model-definition-content highlight-box">
                <h4 class="model-definition-content"><strong>추가 입력 데이터:</strong></h4>
                <ul>
                    <li>\(q_i\): 고객 \(i\)의 수요량 (차고지의 수요 \(q_0=0\))</li>
                    <li>\(Q_k\): 차량 \(k\)의 최대 적재 용량</li>
                </ul>
                <hr>

                <h4 class="model-definition-content"><strong>추가 결정 변수:</strong></h4>
                <ul>
                    <li> <strong>\( y_{ik} \)</strong> : 차량 \( k \) 가 노드 \( i \) 를 방문하면 1, 아니면 0(이진 변수)</li>
                </ul>
                <hr>

                <h4 class="model-definition-content"><strong>CVRP 핵심 제약 조건:</strong></h4>
                <ul>
                    <li><strong>차량 방문 여부 확인 제약:</strong> 이 제약은 경로 변수 \(x_{ijk}\)와 방문 여부 변수 \(y_{ik}\)를 연결합니다.
                        즉, '차량 \( k \) 가 어떤 노드에서든 고객 \( i \) 로 들어오는 경로가 있다면,
                        해당 차량 \( k \) 는 고객 \( i \) 를 방문한 것 \( y_{ik}=1 \) 이다'를 의미합니다.</p>
                        <div class="math-block text-center p-2 my-2 bg-white rounded">
                            $$ \sum_{j \in N_0, j \neq i} x_{jik} = y_{ik} \quad \forall i \in N, \forall k \in K $$
                        </div>
                    </li>
                    <li><strong>차량 용량 제약:</strong> 각 차량 \(k\)에 할당된 고객들의 수요(\(q_i\)) 합은 해당 차량의 용량(\(Q_k\))을 초과할 수 없습니다.
                        <div class="math-block">
                            $$ \sum_{i \in N} q_i \cdot y_{ik} \le Q_k \quad \forall k \in K $$
                        </div>
                    </li>
                </ul>
            </div>
        </div>

        <div class="col-lg-4">
            <div class="card shadow-sm sticky-top" style="top: 20px;">
                <div class="card-header bg-success text-white">
                    <h4 class="h5 mb-0">CVRP Demo 체험하기</h4>
                </div>
                <div class="card-body">
                    <p><strong>CVRP Demo</strong>에서는 아래와 같은 기능을 직접 체험해볼 수 있습니다.</p>
                    <ul>
                        <li>고객 수와 차량 수, 차량 용량 설정</li>
                        <li>차고지 위치 및 고객별 위치와 수요량 설정</li>
                        <li>용량을 고려한 최적 경로 시각화</li>
                    </ul>
                    <a href="{% url 'routing_logistics_app:cvrp_demo' %}" class="btn btn-success btn-block mt-3">
                        데모 페이지로 이동 &rarr;
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
{% endblock %}