{% extends "core/base.html" %}
{% load static %}

{% block title %}Pickup and Delivery Problem (PDP) - Introduction{% endblock %}

{% block styles %}
<style>
    .introduction-content {
        line-height: 1.8;
        font-size: 1.05rem;
    }
    .introduction-content h4 {
        margin-top: 1.5rem;
        margin-bottom: 0.75rem;
        color: #0056b3;
        padding-bottom: 0.25rem;
        border-bottom: 2px solid #007bff;
    }
    .introduction-content ul {
        padding-left: 20px;
    }
    .introduction-content li {
        margin-bottom: 0.5rem;
    }
    .math-model-section {
        background-color: #f8f9fa;
        border: 1px solid #e9ecef;
        border-radius: 5px;
        padding: 15px;
        margin-top: 15px;
    }
    .intro-image {
        max-width: 100%;
        height: auto;
        border: 1px solid #ddd;
        border-radius: 4px;
        padding: 5px;
        margin-top: 10px;
        margin-bottom: 20px;
        display: block;
        margin-left: auto;
        margin-right: auto;
    }
    .image-caption {
        font-size: 0.9rem;
        color: #555;
        text-align: center;
        margin-top: -10px;
        margin-bottom: 20px;
    }
    .highlight-box {
        background-color: #fdeaea; /* 분홍색 계열로 변경 */
        border-left: 5px solid #dc3545; /* 빨간색 테두리 */
        padding: 15px;
        margin: 20px 0;
        border-radius: 4px;
    }
    .highlight-box h4 {
        margin-top: 0;
        color: #721c24;
        border-bottom: none;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid introduction-content">
    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
        <h1 class="h2">수거 및 배송 문제 (Pickup and Delivery Problem - PDP)</h1>
    </div>

    <p><strong>범주: Ⅲ. 경로 최적화 및 물류 (Routing & Logistics)</strong></p>
    <p>
        **수거 및 배송 문제(PDP)**는 차량 경로 문제(VRP)의 중요한 변형 중 하나로, 단순히 여러 고객을 방문하는 것을 넘어 **특정 지점에서 물품을 수거(Pickup)하여 다른 특정 지점으로 배송(Delivery)하는 '한 쌍의 작업'**들을 처리하는 최적 경로를 찾는 문제입니다.
    </p>

    <figure>
        <img src="{% static 'routing_logistics_app/images/pdp_concept.png' %}" alt="PDP 개념도" class="intro-image" style="max-width: 600px;">
        <figcaption class="image-caption">그림 1: PDP 개념 - 각 작업은 수거(P)와 배송(D) 지점 쌍으로 구성됩니다.</figcaption>
    </figure>

    <h4>1. 문제 설명 및 핵심 제약</h4>
    <p>
        PDP의 목표는 VRP와 유사하게 총 운행 거리나 비용을 최소화하는 것이지만, 다음과 같은 고유하고 중요한 제약 조건들이 추가되어 문제의 복잡성이 크게 증가합니다.
    </p>
    <div class="highlight-box">
        <h4>PDP의 핵심 제약 조건</h4>
        <ul>
            <li>
                <strong>선행 제약 (Precedence Constraint):</strong> 모든 작업 쌍에 대해, 수거(Pickup) 지점 방문이 반드시 해당 배송(Delivery) 지점 방문보다 먼저 이루어져야 합니다.
            </li>
            <li>
                <strong>쌍 제약 (Pairing Constraint):</strong> 특정 물품의 수거와 배송은 반드시 동일한 차량에 의해 수행되어야 합니다.
            </li>
            <li>
                <strong>동적 용량 제약 (Dynamic Capacity Constraint):</strong> 차량의 적재량은 수거 지점을 방문할 때마다 증가하고, 배송 지점을 방문할 때마다 감소합니다. 이 과정에서 차량의 총 적재량은 언제나 최대 용량을 초과할 수 없습니다.
            </li>
        </ul>
    </div>
    <p>
        이러한 제약 조건들 때문에 PDP는 단순한 방문 순서 결정 문제를 넘어, 복잡한 순서 및 차량 할당 논리가 요구되는 고차원의 최적화 문제가 됩니다.
    </p>


    <h4>2. 산업 응용 분야</h4>
    <p>PDP는 다양한 현대 물류 및 서비스 산업에서 핵심적인 역할을 합니다.</p>
    <ul>
        <li><strong>공유 모빌리티 재배치:</strong> 사용량이 많은 지역(수거)에서 적은 지역(배송)으로 공유 자전거, 전동 스쿠터 등을 효율적으로 재배치하는 경로를 계획합니다.</li>
        <li><strong>환자 및 승객 운송 (Dial-a-Ride Problem):</strong> 여러 승객의 출발지(수거)와 목적지(배송) 요청을 받아 운행하는 셔틀 버스나 장애인 콜택시 등의 최적 경로를 생성합니다.</li>
        <li><strong>기업 간 물류 (B2B Logistics):</strong> 부품 공급업체(수거)에서 생산 공장(배송)으로 자재를 운송하거나, 여러 지점에서 반품을 수거하여 물류센터로 이송하는 경로를 최적화합니다.</li>
        <li><strong>택배 및 퀵서비스:</strong> 여러 고객으로부터 물품을 수거하여 각기 다른 목적지로 배송하는 서비스의 경로를 계획합니다.</li>
    </ul>

    <h4>3. 수학적 모델의 변화</h4>
    <div class="math-model-section">
        <p>CVRP 모델에서 더 나아가, PDP 모델은 선행 및 쌍 제약을 모델링하기 위한 추가적인 제약식이 필요합니다.</p>
        <ul>
            <li><strong>추가 파라미터:</strong>
                <ul>
                    <li>각 작업 $i$는 수거 노드 $p_i$와 배송 노드 $d_i$로 구성됩니다.</li>
                    <li>$q_i$: 작업 $i$와 관련된 물품의 양 (수거 시 $+q_i$, 배송 시 $-q_i$).</li>
                </ul>
            </li>
            <li>
                <strong>주요 추가 제약식:</strong>
                <p><strong>1. 선행 제약 (Precedence):</strong> 차량이 작업 $i$를 수행할 때, 배송 지점($d_i$) 도착 시간이 수거 지점($p_i$) 도착 시간보다 항상 늦어야 합니다.</p>
                <span class="math-formula">$$T_{d_i} \ge T_{p_i} + \text{service_time}_{p_i} + \text{travel_time}_{p_i, d_i}$$</span>
                <p><strong>2. 쌍 제약 (Pairing):</strong> 수거 노드 $p_i$와 배송 노드 $d_i$는 반드시 같은 차량에 의해 방문되어야 합니다.</p>
                <span class="math-formula">$$\sum_{k \in K} y_{p_i, k} = \sum_{k \in K} y_{d_i, k} \quad (\text{여기서 } y_{jk}\text{는 노드 j를 차량 k가 방문하면 1})$$</span>
                <p><strong>3. 동적 용량 제약:</strong> OR-Tools에서는 `AddDimension`을 사용하여 경로의 각 지점에서의 누적 적재량을 추적하고, 차량의 최대 용량을 초과하지 않도록 제약을 설정할 수 있습니다.</p>
            </li>
        </ul>
        <p>이러한 복잡성 때문에 PDP는 VRP 중에서도 해결하기 어려운 문제 유형에 속합니다.</p>
    </div>

    <h4>4. OptDemo에서의 체험</h4>
    <p>
        본 데모의 "수거 및 배송 문제" 섹션에서는 사용자가 여러 개의 수거-배송 작업 쌍을 정의하고, OR-Tools가 선행, 쌍, 용량 제약을 모두 만족시키면서 최적의 경로를 찾아내는 과정을 시각적으로 확인할 수 있도록 구성될 예정입니다.
    </p>
</div>
{% endblock %}

{% block scripts %}
{# MathJax 로드 (base.html에 이미 Chart.js 등이 있다면 그 이후에 로드하는 것이 좋음) #}
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        console.log("VRP Model Definition page script loaded.");
        if (typeof MathJax !== 'undefined' && MathJax.typeset) {
            // 페이지 로드 후 MathJax가 수식을 렌더링하도록 명시적 호출 (필요한 경우)
            // MathJax.typesetPromise(); // 또는 MathJax.typeset();
        }
    });
</script>
{% endblock %}